#!/bin/bash

# Header
echo "ICAgICAgICAgICAgXyAgICAgICAgICAgICBfICAgIAogICAgICAgICAgIHwgfCAgICAgICAgICAgfCB8ICAgCiAgXyAgIF8gX19ffCB8XyBfXyBfICBfX198IHwgX18KIHwgfCB8IC8gX198IF9fLyBfYCB8LyBfX3wgfC8gLwogfCB8X3wgXF9fIFwgfHwgKF98IHwgKF9ffCAgIDwgCiB8IC5fLF98X19fL1xfX1xfXyxffFxfX198X3xcX1wKIHwgfCAgICAgICAgICAgICAgICAgICAgICAgICAgIAogfF98ICAgICAgICAgICAgICAgICAgICAgICAgICAg"|base64 -d
echo ""
echo ""

# Check if user has dependencies
# Bun
if ! command -v bun &> /dev/null
then
    echo "Bun.sh was not found on the system."
    read -p "Do you want to install it? (y/n) " yn

    case $yn in 
        [yY] ) echo "Installing bun.sh...";
            curl -fsSL https://bun.sh/install | bash;;
        [nN] ) echo "Exiting. Please install bun.sh from https://bun.sh first.";
            exit;;
        * ) echo "Invalid response. Exiting.";
            exit;;
    esac
fi

# Git
if ! command -v git &> /dev/null
then
    echo "Git was not found on the system."
    if ! command -v apt &> /dev/null
    then
        echo "Please install it using your package manager first."
        exit;
    fi
    read -p "Do you want to install it? (y/n) " yn

    case $yn in 
        [yY] ) echo "Installing git...";
            sudo apt install -y git;;
        [nN] ) echo "Exiting. Please install git first.";
            exit;;
        * ) echo "Invalid response. Exiting.";
            exit;;
    esac
fi

parent_path=$( cd "$(dirname "${BASH_SOURCE[0]}")" ; pwd -P )

# Composer
if ! command -v composer &> /dev/null
then
    echo "Composer was not found on the system."
    echo "Please install PHP8.2 and Composer before running this script."
    exit
fi

# All good, run the bun script
bun $parent_path/../src/app.ts $@